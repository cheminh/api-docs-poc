"use strict";(globalThis.webpackChunkapi_docs_poc=globalThis.webpackChunkapi_docs_poc||[]).push([[234],{85047(n,e,i){i.r(e),i.d(e,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"UPDATING","title":"Updating API Documentation","description":"This document explains how the API documentation is automatically updated when APIs change.","source":"@site/docs/UPDATING.md","sourceDirName":".","slug":"/UPDATING","permalink":"/api-docs-poc/docs/UPDATING","draft":false,"unlisted":false,"editUrl":"https://github.com/tripx/api-docs-poc/tree/main/docs/UPDATING.md","tags":[],"version":"current","frontMatter":{}}');var l=i(74848),t=i(28453);const r={},c="Updating API Documentation",o={},d=[{value:"Automated Monitoring",id:"automated-monitoring",level:2},{value:"How It Works",id:"how-it-works",level:3},{value:"Manual Trigger",id:"manual-trigger",level:3},{value:"Configuration",id:"configuration",level:3},{value:"Checksum Storage",id:"checksum-storage",level:3},{value:"GitHub Actions Workflow",id:"github-actions-workflow",level:3},{value:"Notifications",id:"notifications",level:3},{value:"Single API Update",id:"single-api-update",level:3},{value:"All APIs Update",id:"all-apis-update",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Adding New APIs",id:"adding-new-apis",level:2},{value:"Disabling Auto-Updates",id:"disabling-auto-updates",level:2},{value:"Security",id:"security",level:2}];function a(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.header,{children:(0,l.jsx)(e.h1,{id:"updating-api-documentation",children:"Updating API Documentation"})}),"\n",(0,l.jsx)(e.p,{children:"This document explains how the API documentation is automatically updated when APIs change."}),"\n",(0,l.jsx)(e.h2,{id:"automated-monitoring",children:"Automated Monitoring"}),"\n",(0,l.jsx)(e.p,{children:"The system automatically monitors API endpoints for changes every 4 hours using GitHub Actions."}),"\n",(0,l.jsx)(e.h3,{id:"how-it-works",children:"How It Works"}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Monitoring Agent"})," (",(0,l.jsx)(e.code,{children:"scripts/monitor-agent.js"}),") runs on schedule"]}),"\n",(0,l.jsx)(e.li,{children:"Downloads current Swagger spec from live API"}),"\n",(0,l.jsx)(e.li,{children:"Calculates checksum and compares with previous version"}),"\n",(0,l.jsxs)(e.li,{children:["If changed:","\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Updates local OpenAPI spec files"}),"\n",(0,l.jsx)(e.li,{children:"Regenerates documentation"}),"\n",(0,l.jsx)(e.li,{children:"Commits changes automatically"}),"\n",(0,l.jsx)(e.li,{children:"Pushes to repository"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"manual-trigger",children:"Manual Trigger"}),"\n",(0,l.jsx)(e.p,{children:"You can manually trigger a check at any time:"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"npm run monitor\n"})}),"\n",(0,l.jsx)(e.p,{children:"Or via GitHub Actions UI (Actions tab \u2192 Monitor API Changes \u2192 Run workflow)"}),"\n",(0,l.jsx)(e.h3,{id:"configuration",children:"Configuration"}),"\n",(0,l.jsxs)(e.p,{children:["APIs to monitor are configured in ",(0,l.jsx)(e.code,{children:"scripts/monitor-agent.js"}),":"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-javascript",children:'const config = {\n\tdistributionApi: {\n\t\tswaggerUrl:\n\t\t\t"https://tripx-distribution-api.prd.aks.manulife.ca/swagger-ui-init.js",\n\t\tchecksumFile: ".cache/distribution-api-checksum.txt",\n\t},\n};\n'})}),"\n",(0,l.jsx)(e.h3,{id:"checksum-storage",children:"Checksum Storage"}),"\n",(0,l.jsxs)(e.p,{children:["Change detection uses SHA-256 checksums stored in ",(0,l.jsx)(e.code,{children:".cache/"}),":"]}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"distribution-api-checksum.txt"})," - Previous Distribution API state"]}),"\n",(0,l.jsx)(e.li,{children:"Add more as needed for other APIs"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"github-actions-workflow",children:"GitHub Actions Workflow"}),"\n",(0,l.jsxs)(e.p,{children:["Located at ",(0,l.jsx)(e.code,{children:".github/workflows/monitor-api-changes.yml"}),":"]}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Schedule"}),": Every 4 hours (",(0,l.jsx)(e.code,{children:"0 */4 * * *"}),")"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Manual"}),": Can trigger via workflow_dispatch"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Auto-commit"}),": Enabled via ",(0,l.jsx)(e.code,{children:"AUTO_COMMIT=true"})]}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"notifications",children:"Notifications"}),"\n",(0,l.jsx)(e.p,{children:"To enable Slack notifications:"}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsx)(e.li,{children:"Set up Slack Incoming Webhook"}),"\n",(0,l.jsxs)(e.li,{children:["Add webhook URL to GitHub Secrets as ",(0,l.jsx)(e.code,{children:"SLACK_WEBHOOK_URL"})]}),"\n",(0,l.jsxs)(e.li,{children:["Uncomment notification code in ",(0,l.jsx)(e.code,{children:"monitor-agent.js"})]}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"single-api-update",children:"Single API Update"}),"\n",(0,l.jsx)(e.p,{children:"To manually update just one API:"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# Distribution API\nbash scripts/update-api.sh distributionApi\n\n# Or step by step\nnode scripts/filter-api-spec.js\nnpx docusaurus clean-api-docs distributionApi\nnpx docusaurus gen-api-docs distributionApi\nnode scripts/flatten-sidebar.js distributionApi\n"})}),"\n",(0,l.jsx)(e.h3,{id:"all-apis-update",children:"All APIs Update"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"npm run gen-api-docs\n"})}),"\n",(0,l.jsx)(e.p,{children:"This runs sync-api-config and regenerates all API docs."}),"\n",(0,l.jsx)(e.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"No changes detected but API has changed:"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["Delete ",(0,l.jsx)(e.code,{children:".cache/*.txt"})," files to force refresh"]}),"\n",(0,l.jsx)(e.li,{children:"Check if Swagger URL is correct"}),"\n",(0,l.jsx)(e.li,{children:"Verify API is accessible (might need VPN)"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Monitoring fails:"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Check GitHub Actions logs"}),"\n",(0,l.jsx)(e.li,{children:"Verify Node.js version (requires 18+)"}),"\n",(0,l.jsx)(e.li,{children:"Ensure all npm dependencies installed"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Auto-commit not working:"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["Check ",(0,l.jsx)(e.code,{children:"AUTO_COMMIT"})," environment variable"]}),"\n",(0,l.jsx)(e.li,{children:"Verify git config in workflow"}),"\n",(0,l.jsx)(e.li,{children:"Check repository permissions"}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"adding-new-apis",children:"Adding New APIs"}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsxs)(e.li,{children:["Add API config to ",(0,l.jsx)(e.code,{children:"scripts/monitor-agent.js"}),":"]}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-javascript",children:"newApi: {\n  swaggerUrl: 'https://api.example.com/swagger-ui-init.js',\n  checksumFile: '.cache/new-api-checksum.txt'\n}\n"})}),"\n",(0,l.jsxs)(e.ol,{start:"2",children:["\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsxs)(e.p,{children:["Update ",(0,l.jsx)(e.code,{children:"filter-api-spec.js"})," to handle the new API"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"Test manually:"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"npm run monitor\n"})}),"\n",(0,l.jsx)(e.h2,{id:"disabling-auto-updates",children:"Disabling Auto-Updates"}),"\n",(0,l.jsx)(e.p,{children:"To disable automated monitoring:"}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsxs)(e.li,{children:["Delete or disable ",(0,l.jsx)(e.code,{children:".github/workflows/monitor-api-changes.yml"})]}),"\n",(0,l.jsx)(e.li,{children:"Or adjust cron schedule to less frequent interval"}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"security",children:"Security"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"SSL verification disabled for UAT (-k flag in curl)"}),"\n",(0,l.jsx)(e.li,{children:"Production endpoints should use valid certificates"}),"\n",(0,l.jsx)(e.li,{children:"GitHub token has minimal permissions (repo access only)"}),"\n",(0,l.jsx)(e.li,{children:"No sensitive data logged or committed"}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(a,{...n})}):a(n)}}}]);